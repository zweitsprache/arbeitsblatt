# Internationalization (i18n)

This project uses [next-intl](https://next-intl.dev/) for translations.
Translation files are edited directly — no external translation service required.

## Architecture

```
src/messages/{locale}.json  ──load──▶  next-intl
                                         │
                   BLOCK_LIBRARY fallbacks ──┘
                   (code-translations.ts)
```

**The JSON files are the source of truth.** Edit them directly in your editor.

### Supported locales

| Locale | File | Default |
|--------|------|---------|
| `de` (German) | `src/messages/de.json` | ✅ |
| `en` (English) | `src/messages/en.json` | |

Configured in `src/i18n/routing.ts`.

### Translation flow

1. Edit `src/messages/de.json` and `src/messages/en.json` directly
2. `next-intl` loads the JSON at request time (`src/i18n/request.ts`)
3. `BLOCK_LIBRARY` fallback labels are merged for blocks not yet in the JSON files
4. Components consume translations via `useTranslations("namespace")`

## How to add new translations

1. Add the key to **both** `src/messages/de.json` and `src/messages/en.json`
2. Place keys in the correct namespace, in **alphabetical order**
3. Run `npm run i18n:validate` to verify both locales are in sync
4. Commit the updated JSON files

### Adding translations for a new block type

When you add a new block to `BLOCK_LIBRARY` in `src/types/worksheet.ts`:

1. Set `labelKey` and `descriptionKey` (these reference the `blocks` namespace)
2. Add `translations` with `de` values (these serve as fallbacks)
3. Add the keys to both `de.json` and `en.json` in the `blocks` namespace
4. Run `npm run i18n:validate`

The BLOCK_LIBRARY `translations` object provides emergency fallback labels so
the UI never shows raw keys, even before the translations are added to JSON.

## NPM scripts

| Script | Purpose |
|--------|---------|
| `npm run dev` | Starts Next.js dev server |
| `npm run i18n:validate` | Check that `de.json` and `en.json` are in sync |

## Build-time validation

The `build` script runs `validate-translations.mjs` before `next build`.
If any namespace or key is missing in either locale, **the build fails**.
This prevents deploying with broken translations.

```
prisma generate → validate-translations → next build
```

## File reference

| File | Purpose |
|------|---------|
| `src/messages/de.json` | German translations (edit directly) |
| `src/messages/en.json` | English translations (edit directly) |
| `src/i18n/code-translations.ts` | BLOCK_LIBRARY fallback labels only |
| `src/i18n/request.ts` | Server-side message loading + merge |
| `src/i18n/routing.ts` | Locale list + default locale |
| `src/i18n/navigation.ts` | Locale-aware Link, redirect, etc. |
| `src/proxy.ts` | Middleware for locale detection/routing |
| `scripts/validate-translations.mjs` | Build-time parity checker |
