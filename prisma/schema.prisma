generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Folder {
  id         String      @id @default(cuid())
  name       String
  parentId   String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  userId     String?
  parent     Folder?     @relation("FolderTree", fields: [parentId], references: [id], onDelete: Cascade)
  children   Folder[]    @relation("FolderTree")
  worksheets Worksheet[]

  @@index([parentId])
  @@index([userId])
}

model Worksheet {
  id          String   @id @default(cuid())
  type        String   @default("worksheet") // "worksheet" | "flashcards" | future types
  title       String   @default("Untitled Worksheet")
  description String?
  slug        String   @unique
  blocks      Json     @default("[]")
  settings    Json     @default("{}")
  published   Boolean  @default(false)
  thumbnail   String?  // base64 data URL of first-page preview
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  folderId    String?
  userId      String?
  folder      Folder?  @relation(fields: [folderId], references: [id])

  @@index([slug])
  @@index([folderId])
  @@index([userId])
  @@index([type])
}

model EBook {
  id            String   @id @default(cuid())
  title         String   @default("Untitled E-Book")
  slug          String   @unique
  chapters      Json     @default("[]")  // Array of EBookChapter objects
  coverSettings Json     @default("{}")  // EBookCoverSettings
  settings      Json     @default("{}")  // EBookSettings
  published     Boolean  @default(false)
  thumbnail     String?  // base64 data URL of first-page preview
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  folderId      String?
  userId        String?

  @@index([slug])
  @@index([folderId])
  @@index([userId])
}

model Course {
  id                 String    @id @default(cuid())
  title              String    @default("Untitled Course")
  slug               String    @unique
  structure          Json      @default("[]")    // Array of CourseModule objects (Module → Topic → Lesson)
  coverSettings      Json      @default("{}")    // CourseCoverSettings
  settings           Json      @default("{}")    // CourseSettings
  published          Boolean   @default(false)
  thumbnail          String?                     // base64 data URL of first-page preview
  translations       Json      @default("{}")    // { en: { structure, coverSettings, settings }, uk: { ... } }
  i18nexusNamespace  String?                     // i18nexus namespace title for this course
  translatedAt       DateTime?                   // last sync timestamp
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  folderId           String?
  userId             String?

  @@index([slug])
  @@index([folderId])
  @@index([userId])
}

model VerbCache {
  id         String   @id @default(cuid())
  infinitive String   @unique  // normalised: trimmed, lowercased (e.g. "sich vorstellen")
  data       Json              // full VerbConjugationTable including highlights
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([infinitive])
}
