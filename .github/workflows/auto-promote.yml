name: Auto-promote Vercel deployment

on:
  deployment_status:

jobs:
  promote:
    if: github.event.deployment_status.state == 'success' && github.event.deployment.environment == 'Production'
    runs-on: ubuntu-latest
    steps:
      - name: Install Vercel CLI
        run: npm i -g vercel@latest

      - name: Alias to production domains
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          DEPLOY_URL="${{ github.event.deployment_status.target_url }}"
          echo "Promoting deployment: $DEPLOY_URL"
          vercel alias set "$DEPLOY_URL" app.arbeitsblatt.ch --token=$VERCEL_TOKEN --scope=admin-2445s-projects
          vercel alias set "$DEPLOY_URL" arbeitsblatt.vercel.app --token=$VERCEL_TOKEN --scope=admin-2445s-projects
          echo "Done! Both domains now point to: $DEPLOY_URL"
